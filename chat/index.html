<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss-cdn@3.4.10/tailwindcss.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="/index.js"></script>
    <link rel="stylesheet" href="/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <title>Bolt M3 AI Chat</title>
  </head>

  <body class="bg-[#2a2b2d] text-white font-montserrat">
    <nav class="flex items-center justify-between p-6 bg-[#1a1b1d] shadow-md">
      <img
        src="https://ad2ab94.webp.ee/logo.webp"
        alt="Logo"
        class="h-12 hover:scale-105 transition-transform duration-200 ease-in-out"
      />
      <div class="lg:hidden">
        <button class="text-white focus:outline-none" onclick="toggleMenu()">
          <i class="fa fa-bars text-2xl"></i>
        </button>
      </div>
      <ul class="hidden lg:flex space-x-8 text-lg font-semibold">
        <li><a href="/" class="text-white hover:text-red-500">Home</a></li>
        <li><a href="/team" class="text-white hover:text-red-500">Team</a></li>
        <li>
          <a
            href="https://zertte-studio.kz/"
            class="text-lg font-semibold text-white hover:text-red-500"
            >Zertte Studio</a
          >
        </li>
        <li><a href="/chat" class="text-white hover:text-red-500">Chat</a></li>
        <li>
          <a href="/sponsors" class="text-white hover:text-red-500">Sponsor</a>
        </li>
      </ul>
      <div
        id="mobileMenu"
        class="lg:hidden absolute top-16 left-0 w-full bg-[#1a1b1d] text-center hidden"
      >
        <ul class="space-y-4 py-4">
          <li>
            <a href="/" class="text-white hover:text-red-500 block">Home</a>
          </li>
          <li>
            <a href="/team" class="text-white hover:text-red-500 block">Team</a>
          </li>
          <li>
            <a
              href="https://zertte-studio.kz/"
              class="text-white hover:text-red-500 block"
              >Zertte Studio</a
            >
          </li>
          <li>
            <a href="/chat" class="text-white hover:text-red-500 block">Chat</a>
          </li>
          <li>
            <a href="/sponsors" class="text-white hover:text-red-500 block"
              >Sponsor</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <section class="flex flex-col items-center py-16 px-8">
      <h1 class="text-4xl font-bold mb-6">Bolt M3 AI Chat 🤖</h1>
      <p class="text-xl mb-12 text-center">
        Chat with our AI 🤖 and get instant responses! 💬
      </p>

      <!-- Chatbox -->
      <div
        id="chatBox"
        class="flex flex-col space-y-4 w-full max-w-lg bg-[#1a1b1d] p-6 rounded-lg shadow-lg h-[400px] overflow-y-auto"
      >
        <!-- Initial AI Message -->
        <div class="chat chat-start">
          <div class="chat-bubble">
            I am the Bolt.m3 bot 🤖, designed to assist Team Bolt.m3. Please
            tell me your question! 💬
          </div>
        </div>
      </div>

      <!-- Input and Button -->
      <div class="flex flex-col items-center w-full max-w-lg mt-8">
        <textarea
          id="inputText"
          placeholder="Enter your message... "
          class="textarea textarea-bordered w-full h-24 bg-[#1a1b1d] text-white mb-4 p-4"
        ></textarea>
        <button
          onclick="sendPostRequest()"
          id="sendButton"
          class="btn btn-primary bg-red-500 hover:bg-red-600 text-white flex items-center gap-2 px-6 py-3 font-semibold rounded-md"
        >
          <i class="fas fa-paper-plane"></i> Send
        </button>
      </div>
    </section>

    <!-- Main Content End -->

    <footer class="bg-[#1a1b1d] p-6 mt-16">
      <div class="flex justify-center items-center mb-8 space-x-16">
        <div class="flex flex-col items-center">
          <img
            src="https://ad2ab94.webp.ee/logo-bigger.webp"
            alt="Bolt.m3 Logo"
            class="h-16 mb-4"
          />
          <div class="flex space-x-4 mb-4">
            <a
              href="https://www.instagram.com/bolt.m3/"
              class="text-white hover:text-red-500"
              ><i class="fab fa-instagram fa-2x"></i
            ></a>
            <a
              href="https://www.tiktok.com/@bolt.m3_ftc"
              class="text-white hover:text-red-500"
              ><i class="fab fa-tiktok fa-2x"></i
            ></a>
            <a
              href="https://www.youtube.com/channel/UCuSTuLznWnVQ2FV-f8L-xHA"
              class="text-white hover:text-red-500"
              ><i class="fab fa-youtube fa-2x"></i
            ></a>
          </div>
        </div>
        <div class="flex flex-col items-start ml-8">
          <a
            href="/team"
            class="text-lg font-semibold text-white hover:text-red-500 mb-2"
            >Team</a
          >
          <a
            href="https://zertte-studio.kz/"
            class="text-lg font-semibold text-white hover:text-red-500 mb-2"
            >Zertte Studio</a
          >
          <a
            href="/chat"
            class="text-lg font-semibold text-white hover:text-red-500 mb-2"
            >Chat</a
          >
          <a
            href="/sponsors"
            class="text-lg font-semibold text-white hover:text-red-500 mb-2"
            >Sponsor</a
          >
        </div>
      </div>
      <div class="flex justify-center items-center">
        <p class="text-lg">Built with ❤️ by Team Bolt.m3</p>
      </div>
    </footer>

    <!-- Script -->
    <script>
      async function sendPostRequest() {
        // 获取输入框和按钮元素
        const input = document.getElementById("inputText").value;
        const chatBox = document.getElementById("chatBox");
        const sendButton = document.getElementById("sendButton"); // 假设按钮的id是sendButton

        // 禁用按钮，防止重复点击
        sendButton.disabled = true;

        // 如果输入为空，显示提示消息，并停止发送请求
        if (input.trim() === "") {
          chatBox.innerHTML += `
                  <div class="chat chat-start">
                      <div class="chat-bubble">Please enter a message. Your message cannot be empty. 🚫</div>
                  </div>
              `;
          chatBox.scrollTop = chatBox.scrollHeight;
          sendButton.disabled = false; // 重新启用按钮
          return; // 退出函数，不继续执行
        }

        // 如果输入的文本不是英文，显示提示消息，并停止发送请求
        const isEnglish = /^[A-Za-z0-9\s,.'-?!\n\t’]+$/.test(input);

        // 使用正则表达式检测是否为英语
        if (!isEnglish) {
          chatBox.innerHTML += `
                  <div class="chat chat-start">
                      <div class="chat-bubble">Please write your message in English. 🌍</div>
                  </div>
              `;
          chatBox.scrollTop = chatBox.scrollHeight;
          sendButton.disabled = false; // 重新启用按钮
          return; // 退出函数，不继续执行
        }

        // 如果输入有效，添加用户消息到聊天框（chat-end表示用户消息）
        chatBox.innerHTML += `
              <div class="chat chat-end">
                  <div class="chat-bubble">${input} 🗨️</div>
              </div>
          `;

        // 创建一个新的div来显示AI的响应（初始为加载状态）
        const responseDiv = document.createElement("div");
        responseDiv.classList.add("chat", "chat-start"); // chat-start表示AI的消息
        responseDiv.innerHTML = `<div class="chat-bubble">Loading... <i class="fas fa-spinner fa-spin"></i></div>`;
        chatBox.appendChild(responseDiv); // 将加载状态消息添加到聊天框

        // 滚动到聊天框的最底部，确保最新的消息可见
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
          // 假设 usePostRequest 变量用于决定请求类型
          let usePostRequest = 0; // 如果设置为 1 使用 POST 请求，设置为 0 使用 GET 请求

          let response,result,result_ai;
          if (usePostRequest) {
            // 使用 POST 请求
            // 发送POST请求到后端API
            response = await fetch("https://ai.bolt-m3kz.workers.dev", {
              method: "POST",
              headers: {
                "Content-Type": "application/json", // 发送JSON格式的数据
              },
              body: JSON.stringify({ input: input }), // 包含用户输入的JSON请求体
            });
            console.log(response);
            result_ai = await response.json().output;
            if(result_ai === undefined)
            {
              result="Hello, there was an issue. Please contact the website administrator.";
            }
          } else {
            // 使用 GET 请求
            response = await fetch(
              `https://rag.bolt-m3kz.workers.dev/?text=${encodeURIComponent(
                input
              )}`,
              {
                method: "GET", // 使用GET请求
                headers: {
                  "Content-Type": "application/json", // 设置请求头
                },
              }
            );

            result = await response.text();
          }

          // 解析响应数据为纯文本
          
          console.log("result:", result);

          // 根据API返回的结果更新AI的消息
          responseDiv.innerHTML = `<div class="chat-bubble">${result} 🗣️</div>`;
        } catch (error) {
          // 捕获任何错误并显示错误信息
          responseDiv.innerHTML = `<div class="chat-bubble">Error: ${error.message} ❌</div>`;
        }

        // 滚动到聊天框的最底部，确保最新的消息可见
        chatBox.scrollTop = chatBox.scrollHeight;

        // 重新启用按钮
        sendButton.disabled = false;
      }
    </script>
  </body>
</html>
